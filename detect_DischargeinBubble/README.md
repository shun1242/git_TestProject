# 気中放電検出プログラム
概要
このプログラムは、気泡の輝度データと放電位置データを使用して、気中放電を検出します。検出結果は CSV ファイルとして出力され、さらに時間と放電位置の散布図を生成します。


## 必要な環境
Python 3.7 以上
必要なライブラリ
pandas
numpy
openpyxl
matplotlib

インストール方法：
pip install pandas numpy openpyxl matplotlib


## パラメータの説明
config.json ファイル内で以下のパラメータを設定します。

bGray（輝度のしきい値）
気中放電と判定するための輝度のしきい値です。この値以上の輝度を持つ気泡が検出されます。
型：整数
例：100

frame（フレーム数）
放電発生位置の何フレーム前を見て気泡の有無を判断するか。
型：整数
例：2

pLength（ピクセル長）
1 ピクセルあたりの長さ（μm）を表します。実際の距離に変換するために使用します。
型：浮動小数点数
例：1.0

Image_size（画像サイズ）
画像の縦方向のピクセル数です。放電位置の計算に使用します。
型：整数
例：640

y2（位置補正値）
放電位置の計算時に使用する補正値です。画像の位置合わせに使用します。
型：整数
例：600

bubble_path（気泡データのパス）
気泡の輝度データファイル（Excel または CSV）のファイルパスです。
型：文字列
例："data/bubble_data.xlsx"

spark_path（放電データのパス）
放電位置データファイル（CSV）のファイルパスです。
型：文字列
例："data/spark_data.csv"

output_path（出力ディレクトリのパス）
結果を保存するディレクトリのパスです。プログラムはこのディレクトリ内に結果の CSV ファイルとプロット画像を自動的に生成します。
型：文字列
例："output/"
注意：output_path はディレクトリパスです。パスの末尾にスラッシュ /（またはバックスラッシュ \）を含めてください。

## 使い方

1. `config.json` ファイルに必要なパラメータを設定します。
2. ターミナルで以下のコマンドを実行します。
python main.py

3. 結果の確認
指定した output_path ディレクトリ内に、結果の CSV ファイルとプロット画像が出力されます。
ファイル名は実行時の日時に基づいて自動生成されます。
例：result_YYYYMMDD_HHMMSS.csv
例：result_YYYYMMDD_HHMMSS_plot.png

## ファイル構成
- main.py：プログラムのエントリーポイント
- config.py：設定の管理
- data_loader.py：データの読み込み
- processor.py：データの処理と気中放電の検出
- output_writer.py：結果の出力
- visualizer.py：結果データの可視化
- config.json：設定ファイル
- requirements.txt：必要なライブラリの一覧

## 注意事項
データファイルの形式：入力データの形式が正しいことを確認してください。
ライブラリのインストール：必要なライブラリがインストールされていることを確認してください。

データファイルの形式
入力データの形式が正しいことを確認してください。
**気泡の輝度データと放電位置データのフレーム数が同じであること**が望ましいです。
そうでない場合、範囲外のインデックスが発生する可能性があります。
k_frame や Discharge_p がデータの範囲外の場合、その行のデータは欠損値として処理されます。

出力データの行数
出力された CSV ファイルは、元の放電位置データと同じ行数になります。
気中放電が検出されなかったフレームも、データなし（*）として出力されます。

気泡の輝度データの行の順序について
プログラム内で、**気泡の輝度データの行を逆転**させています。
これにより、放電位置データと座標系が一致し、正しくデータを参照できます。

パスの指定方法
  - 設定ファイル（`config.json`）でファイルパスを指定する際、**バックスラッシュ `\` を使用する場合はダブルバックスラッシュ `\\` にしてください**。
  - もしくは、**スラッシュ `/` を使用してパスを指定する**ことも可能です。
  - これは、JSONファイル内でバックスラッシュがエスケープ文字として解釈されてしまう問題を回避するためです。
  -output_pathはディレクトリパス。注意：パスの末尾にスラッシュ /（またはバックスラッシュ \）を含めてください。

エンコーディングの問題
放電位置データ（CSV ファイル）の文字エンコーディングが UTF-8 以外の場合、プログラムが読み込めないことがあります。
必要に応じて、data_loader.py 内のエンコーディング指定を調整してください。
例：encoding='cp932' を指定することで、日本語のファイルを正しく読み込めます。
ファイルパスに日本語や特殊文字を含む場合

ファイルパスに日本語や特殊文字（スペース、括弧、記号など）が含まれる場合、正しく読み込めない可能性があります。
必要に応じて、パスを英数字のみで構成し、短くわかりやすいものにしてください。